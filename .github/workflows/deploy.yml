name: Deploy Task Greot

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        
      - name: Inject Telegram token
        env:
          TELEGRAM_TOKEN: ${{ secrets.TOKEN_ONE }}
        run: |
          echo "Токен получен (первые 10 символов): ${TELEGRAM_TOKEN:0:10}..."
          
          # Читаем HTML файл
          HTML_CONTENT=$(cat index.html)
          
          # Заменяем токен в конфигурации JavaScript
          HTML_CONTENT="${HTML_CONTENT//TELEGRAM_BOT_TOKEN: 'TOKEN_PLACEHOLDER'/TELEGRAM_BOT_TOKEN: '${TELEGRAM_TOKEN}'}"
          
          # Сохраняем обратно
          echo "$HTML_CONTENT" > index.html
          
          # Проверяем что замена произошла
          echo "Проверка замены токена:"
          grep -n "TELEGRAM_BOT_TOKEN" index.html | head -5
          
      - name: Setup Pages
        uses: actions/configure-pages@v3
        
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v1
        with:
          path: '.'
          
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2
